/* Copyright (c) 2012 Jeremiah Goyette */
(function(a){function b(a,b){var c=Math.round(a*Math.pow(10,b))/Math.pow(10,b);return c}"use strict";var c=a.setGraph=function(a){function f(a){while(a>=c.m)a-=c.m;while(a<0)a+=c.m;return b(a,2)}function g(a){var b=Math.cos(a/c.m*2*Math.PI),d=Math.sin(a/c.m*2*Math.PI);return{x:r*d+r+p,y:-1*r*b+r+p}}function h(a){var b,c=-1;for(b=e.length-1;b>=0;b--)e[b].pc==a&&c++;return c<1&&(c=0),(1+c*dsize_inc)*dsize}function i(){for(var a=e.length-1;a>=0;a--){if(!e[a].fixed){var b=g(e[a].pc);e[a].dot.attr({cx:b.x,cy:b.y})}e[a].dot.attr({r:h(e[a].pc)})}}var c={},d,e=[];active=!1,r=180,p=30,csize=2*(r+p),tsize=5,dsize=8,dsize_inc=.5,dotclick=function(){return!1};var j=function(a,b){this.pc=a||0,this.fixed=b||!1;var c=g(a);this.dot=d.circle(c.x,c.y,h(a)),this.dot.attr({fill:"black"}),this.dot.click(dotclick)};return c.configure=function(a){r=a.radius||r,p=a.padding||p,csize=2*(r+p),tsize=a.ticksize||tsize,dsize=a.dotsize||dsize,dsize_inc=a.dotsizeinc||dsize_inc,dotclick=a.dotclick&&typeof a.dotclick=="function"?a.dotclick:dotclick},c.plotpcs=function(b,f){d&&(c.clear(d),e=[]),d=new Raphael(document.getElementById(a),csize,csize);var h=d.circle(r+p,r+p,r);h.attr({"stroke-width":4});for(var k=0;k<c.m;k++){var l=g(k),m=d.circle(l.x,l.y,tsize);m.attr({fill:"white"})}if(b)for(var k=b.length-1;k>=0;k--){f=f||0;var n=k>=f?!1:!0,o=new j(b[k],n);e.unshift(o)}i()},c.getpcs=function(){var a=[];for(var b=e.length-1;b>=0;b--)a.unshift(e[b].pc);return a},c.transpose=function(a,b){for(var c=e.length-1;c>=0;c--)e[c].fixed||(e[c].pc=f(e[c].pc+a));i(),b&&typeof b=="function"&&b()},c.animTranspose=function(a,b){function j(){var c=a*d/g;for(var k=e.length-1;k>=0;k--)e[k].fixed||(e[k].pc=f(h[k]+c));i(),b&&typeof b=="function"&&b(),d<g?setTimeout(function(){j()},10):active=!1,d++}if(active)return;active=!0;var d=0,g=40,h=c.getpcs();j()},c.invert=function(a,b){for(var c=e.length-1;c>=0;c--)e[c].fixed||(e[c].pc=f(a-e[c].pc));i(),b&&typeof b=="function"&&b()},c.animInvert=function(a,b){function k(){var l=d/i;for(var m=e.length-1;m>=0;m--){if(!e[m].fixed){var n=f(a-2*j[m]);n>c.m/2&&(n-=c.m),e[m].pc=f(j[m]+l*n);var o=g(e[m].pc);e[m].dot.attr({cx:o.x,cy:o.y})}e[m].dot.attr({r:h(e[m].pc)})}b&&typeof b=="function"&&b(),d<i?setTimeout(function(){k()},10):active=!1,d++}if(active)return;active=!0;var d=0,i=40,j=c.getpcs();k()},c.animInvertDirect=function(a,b){function n(){var g=c/d;for(var k=e.length-1;k>=0;k--)if(!e[k].fixed){var l=i[k].x+g*(j[k].x-i[k].x),m=i[k].y+g*(j[k].y-i[k].y);e[k].dot.attr({cx:l,cy:m})}if(c<d)setTimeout(function(){n()},10);else{for(var k=e.length-1;k>=0;k--)e[k].fixed||(e[k].pc=f(a-e[k].pc));for(var k=e.length-1;k>=0;k--)e[k].dot.attr({r:h(e[k].pc)});b&&typeof b=="function"&&b(),active=!1}c++}if(active)return;active=!0;var c=0,d=40,i=[],j=[];for(var k=e.length-1;k>=0;k--){var l=0;e[k].fixed?(i.unshift(0),j.unshift(0)):(i.unshift(g(e[k].pc)),j.unshift(g(f(a-e[k].pc))));for(var m=e.length-1;m>=0;m--)k!=m&&e[k].pc==e[m].pc&&e[k].fixed==e[m].fixed&&l++;e[k].dot.attr({r:(1+l*dsize_inc)*dsize})}n()},c.clear=function(){if(!d)return;var a=d.canvas;a.parentNode.removeChild(a)},c}})(window)